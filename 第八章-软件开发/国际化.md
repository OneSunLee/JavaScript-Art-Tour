## 国际化

---

### 国际化与本地化

在信息技术领域，*国际化*（internationalization）是指在应用程序中用来适应各种语言和区域，而无需在编程时专门处理的一种方式，它将软件与特定语言及地区、文化等摆脱直接关联。国际化提供以下机制：

- 语言、地区、文化相关的内容与软件本身的逻辑不相关。
- 开发软件的过程中不需要关心具体的信息呈现。
- 当软件被设计为在不同的语言及地区使用时，软件本身不需要进行修改，

而*本地化*（localization）则是基于国际化的机制，将软件的交互内容，与适用的语言、文化、地区等相匹配的过程，在这个过程中决定具体给用户呈现何种信息。

> 国际化和本地化之间的关系虽然微妙，但却很重要。简单来说，国际化意味着产品有适用于任何地方的“潜力”，本地化则是为了更适合于“特定”地方的使用，而另外增添的特色。对于一个软件项目来说，国际化是在设计过程中考虑、开发过程中只做一次，但本地化则要针对不同的区域各做一次。这两者之间是互补的，并且两者合起来才能让软件产品拥有良好的广泛适用性。
>
> ——Wikipedia

由于国际化和本地化两个英文单词太长，常被分别简称为*i18n*（代表在 i 和 n 两个首尾字母之间有 18 个字母）和*L10n*（使用大写的 L 以区分数字 1）。



---

Note：

在微软及 IBM 等企业中，则会使用*全球化*（globalization）来表示此两者的合称。在英文中，也会使用 *g11n* 作为简称。

---



国际化与本地化工作的焦点包括：

1. 语言
   - 电子文件
     - 字母。目前绝大多数的应用程序都采用 Unicode 为标准来解决字符编码的问题。
     - 不同的数字命名系统。
     - 书写方向。英文、中文等是从左往右书写，而阿拉伯文、希伯来文等则是从右往左书写。另一些语言文字，如满文和蒙古文是从上往下书写，还有极少数文字（如 Hanunó'o）从下往上书写。
     - 相同语言在不同地区的拼法差异，如美国英语和加拿大英语使用 *localization* ，而英国英语和澳大利亚英语使用 *localisation*。
     - 文件处理上的差异，如某些文字存在大小写，其它则否。字母顺序。
   - 文字的图像表示。
   - 读法
   - 视频的字幕
2. 文化
   - 图片和颜色：这牵涉到理解和文化适宜的议题。
   - 名字和称谓
   - 政府给定的编码（如美国的社会安全码，英国的 National Insurance number，爱沙尼亚的 Isikukood 及其它各国的身份证号码）和护照
   - 电话号码、地址和国际邮递区号
   - 货币
     - 标志符号
     - 货币标志的位置
   - 用于度量衡的单位
   - 纸张大小
3. 书写习惯
   - 日期和时间的格式，包含各式日历。
   - 时区（以国际标准时间为准）
   - 数字格式
     - 小数点的类型
     - 分隔点的位置
     - 分隔所用的字符
   - 产品和服务所面向的法规

而有关本地化的主题则包括：

- 翻译
- 针对特定语言（如东亚语言）的特别支持
- 符合当地习俗和观念的交互信息
- 符号
- 排序方法
- 美学、文化价值和社会环境





### 国际化利器 Intl

国际化的意义在于本地化，本地化一般分两种情况考虑，即数据呈现格式和用户信息内容。传统的桌面应用程序根据运行环境的*区域设置*，决定使用何种方式来呈现数据，如小数点的类型、货币的单位等。


> *区域设置*（locale）是计算机中一套定义用户的语言、国家和用于定义用户希望在其用户界面上看到的各种可以改变的选择的参数集合。通常一个 locale 标识符至少包括一个语言标识符和一个区域标识符。
>
> 在 UNIX 和 Windows 中，locale 的控制是不同的。在 UNIX 下，通常通过环境变量来控制 locale。这些环境变量包括：`LANG`, `LC_ALL`, `LC_CTYPE`, `LC_TIME`, 等等。你可以通过改变这些环境变量来控制你的程序或者命令所表现出来的 locale，前提是这些程序或者命令必须是已经被国际化的和本地化的。在 Windows 下，你可以通过改变控制面板上的“语言/区域”中的区域的值来设定 Windows 的当前用户的 locale。
>
> ——Wikipedia

而用户信息内容处理起来则相对棘手。一些桌面开发框架（如 C++ 的 Qt）采取的方式是，当应用程序在某个地方需要呈现一段信息，那么就在这里留一个占位记号，然后对源程序进行处理，生成对应于每种支持语言的*翻译文件*，将每条信息的含义与目标语言一一对应，再由专门的翻译人员填写每条信息应当呈现出的内容。

而在 JavaScript 中，一切都变得非常简单——浏览器封装了有关国际化与本地化的底层细节，提供了一个称为 `Intl` 的对象来完成所有事情。JavaScript 开发者无需在项目中加入许多 KB 的翻译文件。`Intl` 有各种构造函数和方法，这些构造函数和方法将 locale 作为参数并可以根据我们的需要格式化数据。

`Intl` 对象包括以下这些构造函数：

- `Collator`
- `DateTimeFormat`
- `ListFormat`
- `NumberFormat`
- `PluralRules`
- `RelativeTimeFormat`

它们接受两个参数 `locale` 和 `options`。`locale` 必须是符合 BCP 47 语言标记规范的字符串或数组。

> BCP 47 语言标记用于定义一种语言，它包含了该语言的主要信息。在正常情况下，它按顺序包含：语言代码，脚本代码和国家或地区代码，这些信息都用连字符分隔。虽然这些标签不区分大小写，但建议用标题大小写来写脚本代码，用大写来写国家和地区代码，用小写来写其他内容。
>
> ——Mozilla Developer Network

`locale` 参数的默认值为当前运行程序的语言环境（区域设置）。语言环境一般写成：`en`（英语），`hi`（印地语），`ta-in`（泰米尔语 - 印度）等。`options` 参数是可选的，其结构因不同的构造函数而异，主要用于提供格式化的自定义信息。

接下来，我们将详细了解如何使用 `Intl` 作为国际化的有力工具。

在本文中，我们将介绍在命名空间 Intl 中添加的一些新 [API](http://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&mid=2651232880&idx=2&sn=12ef569f8e77adcc561595b38715a46e&chksm=bd4943f48a3ecae2f46085969df7216dd2d379732f3213c78f9b7ab6f5f665104248326e6758&scene=21#wechat_redirect)。这些新 API 已经在 Google I/O '19 中公布。下面让我们来详细了解一下这些 API。





### 日期和时间处理

RelativeTimeFormat 构造函数用于将时间戳转换为人性化短语。它将包含许多信息却不利于人类阅读的 `Date` 对象实例，转换为其相对当前时间的字符串。让我们来看下面这个例子：

```javascript
// 把相对时间转换为英语口语
const rtf = new Intl.RelativeTimeFormat("en", { numeric: "auto" });
alert(rtf.format(-1, "month")); // "last month"
alert(rtf.format(0, "month"));  // "this month"
alert(rtf.format(1, "month"));  // "next month"
alert(rtf.format(-1, "week"));  // "last week"
alert(rtf.format(0, "week"));   // "this week"
alert(rtf.format(1, "week"));   // "next week"
alert(rtf.format(-1, "day"));   // "yesterday"
alert(rtf.format(0, "day"));    // "today"
alert(rtf.format(1, "day"));    // "tomorrow"
```

上面的栗子中，I构造函数 `Intl.RelativeTimeFormat` 的第一个参数为 `"en"` 。配置项 `options` 中的 `numeric` 属性可以设置为 `"always"` 或 `"auto"`，其中 `"always"` 不会将相对日期转换为口语。例如：

```javascript
// 现在 options 的 numeric 属性值为 "always"
alert(rtf.format(-1, "month")); // "1 day ago"
alert(rtf.format(2, "day"));    // "in 2 days"
```

我们也可以选择其它语言的相对日期，例如中文或泰米尔文。

```javascript
const rtf2 = new Intl.RelativeTimeFormat("zh-cn", { numeric: "auto" });
alert(rtf2.format(-1, "day"));    // "昨天"
alert(rtf2.format(2, "day"));     // "后天"
alert(rtf2.format(1, "year"));    // "明年"
alert(rtf2.format(10, "second")); // "10秒钟后"
const rtf3 = new Intl.RelativeTimeFormat("ta-in", { numeric: "auto" });
alert(rtf3.format(-1, "day"));    // "நேற்று"
alert(rtf3.format(2, "month"));   // "2 மாதங்களில்"
alert(rtf3.format(1, "year"));    // "அடுத்த ஆண்டு"
```

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)Intl.RelativeTimeFormat 构造函数 with ta-in locale

像昨天、今天、明天这样的短语，可以给用户提供更好的使用体验。